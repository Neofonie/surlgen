options {
    STATIC = false ;
}

PARSER_BEGIN(UrlMappingParser)
package de.neofonie.surlgen.urlmapping.parser;

import java.io.StringReader;
import java.util.ArrayList;
import java.util.List;

public class UrlMappingParser {

    public static UrlPattern parse( String expression ) throws ParseException, TokenMgrError {
        UrlMappingParser parser = new UrlMappingParser( new StringReader(expression) ) ;
        return parser.start();
    }
}
PARSER_END(UrlMappingParser)

SKIP:  { " " | "\t" | "\n" | "\r"                    }
TOKEN: {
< ANYTHING : (~["{", "}", "[", "]"])+ >
| "(" | ")" | "[" | "]" | "+" | "*" | <NUM: (["0"-"9"])+>
}

private UrlPattern start(): {UrlPattern t;} {
    t = tokenList() <EOF>
    {return t;}
}

private UrlPattern tokenList(): {UrlPattern p; List<UrlPattern> list = new ArrayList();} {
    ( p = token() { list.add(p); } )+
    { return PatternList.create(list); }
}

private UrlPattern token(): {Token t; UrlPattern p;} {
    ( "[" p = tokenList() "]" { return new Choice(p); }
    | t = <ANYTHING> { return new StaticUrlPattern(t.image); }
    )
}

private UrlPattern choice(): {Token t;UrlPattern p;} {
    "[" p = anything() "]" { return new Choice(p); }
}
private UrlPattern anything(): {Token t;} {
    t = <ANYTHING> { return new StaticUrlPattern(t.image); }
}